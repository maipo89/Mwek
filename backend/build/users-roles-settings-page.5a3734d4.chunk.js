(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[8853],{16098:(F,B,o)=>{"use strict";o.r(B),o.d(B,{default:()=>bs});var s=o(67294),E=o(49656),p=o(68547),v=o(31498),R=o(81912),A=o(19408),D=o(78862),y=o(62031),f=o(41798),U=o(26851),P=o(49425),N=o(84686),Z=o(80768),G=o.n(Z),O=o(97132),L=o(23724),H=o(63852),_=o(89031),re=(r,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(r,e)).next())});const Je=(r,e)=>re(void 0,null,function*(){try{const{data:t}=yield _.be.get((0,_.Gc)("roles"));return e("The roles have loaded successfully"),t}catch(t){throw r({type:"warning",message:{id:"notification.error"}}),new Error("error")}}),qe=(r,e)=>re(void 0,null,function*(){try{yield _.be.delete(`${(0,_.Gc)("roles")}/${r}`)}catch(t){e({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}});var et=o(45697),C=o.n(et),se=o(30741),X=o(67826),tt=o(19352),rt=o.n(tt),st=o(18568),nt=o.n(st),ot=Object.defineProperty,ne=Object.getOwnPropertySymbols,at=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable,oe=(r,e,t)=>e in r?ot(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ae=(r,e)=>{for(var t in e||(e={}))at.call(e,t)&&oe(r,t,e[t]);if(ne)for(var t of ne(e))it.call(e,t)&&oe(r,t,e[t]);return r};const Y=({sortedRoles:r,canDelete:e,permissions:t,setRoleToDelete:i,onDelete:u})=>{const{formatMessage:l}=(0,O.useIntl)(),{push:d}=(0,E.useHistory)(),[a,n]=u,c=m=>e&&!["public","authenticated"].includes(m.type),g=m=>{i(m),n(!a)},h=m=>{d(`/settings/${v.Z}/roles/${m}`)};return s.createElement(f.Tbody,null,r==null?void 0:r.map(m=>s.createElement(f.Tr,ae({key:m.name},(0,p.onRowClick)({fn:()=>h(m.id)})),s.createElement(f.Td,{width:"20%"},s.createElement(P.Typography,null,m.name)),s.createElement(f.Td,{width:"50%"},s.createElement(P.Typography,null,m.description)),s.createElement(f.Td,{width:"30%"},s.createElement(P.Typography,null,`${m.nb_users} ${l({id:"global.users",defaultMessage:"users"}).toLowerCase()}`)),s.createElement(f.Td,null,s.createElement(X.Flex,ae({justifyContent:"end"},p.stopPropagation),s.createElement(p.CheckPermissions,{permissions:t.updateRole},s.createElement(se.IconButton,{onClick:()=>h(m.id),noBorder:!0,icon:s.createElement(rt(),null),label:l({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${m.name}`})})),c(m)&&s.createElement(p.CheckPermissions,{permissions:t.deleteRole},s.createElement(se.IconButton,{onClick:()=>g(m.id),noBorder:!0,icon:s.createElement(nt(),null),label:l({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${m.name}`})})))))))},lt=Y;Y.defaultProps={canDelete:!1},Y.propTypes={onDelete:C().array.isRequired,permissions:C().object.isRequired,setRoleToDelete:C().func.isRequired,sortedRoles:C().array.isRequired,canDelete:C().bool};var ie=(r,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(r,e)).next())});const ct=()=>{const{trackUsage:r}=(0,p.useTracking)(),{formatMessage:e}=(0,O.useIntl)(),{push:t}=(0,E.useHistory)(),i=(0,p.useNotification)(),{notifyStatus:u}=(0,N.useNotifyAT)(),[{query:l}]=(0,p.useQueryParams)(),d=(l==null?void 0:l._q)||"",[a,n]=(0,s.useState)(!1),[c,g]=(0,s.useState)(!1),[h,m]=(0,s.useState)();(0,p.useFocusWhenNavigate)();const T=(0,L.useQueryClient)(),b=(0,s.useMemo)(()=>({create:R.Z.createRole,read:R.Z.readRoles,update:R.Z.updateRole,delete:R.Z.deleteRole}),[]),{isLoading:M,allowedActions:{canRead:I,canDelete:V}}=(0,p.useRBAC)(b),{isLoading:Ts,data:{roles:te},isFetching:Ds}=(0,L.useQuery)("get-roles",()=>Je(i,u),{initialData:{},enabled:I}),Ye=Ts||Ds,As=()=>{r("willCreateRole"),t(`/settings/${v.Z}/roles/new`)},Ls=()=>{n(!a)},Ss={roles:{id:(0,_.OB)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,_.OB)("Roles.empty.search"),defaultMessage:"No roles match the search."}},ws=e({id:"global.roles",defaultMessage:"Roles"}),Ms=(0,L.useMutation)(Bs=>qe(Bs,i),{onSuccess:()=>ie(void 0,null,function*(){yield T.invalidateQueries("get-roles")})}),Is=()=>ie(void 0,null,function*(){g(!0),yield Ms.mutateAsync(h),n(!a),g(!1)}),W=(0,H.ZP)(te||[],d,{keys:["name","description"]}),Us=d&&!W.length?"search":"roles",js=4,xs=((te==null?void 0:te.length)||0)+1;return s.createElement(D.Layout,null,s.createElement(p.SettingsPageTitle,{name:ws}),s.createElement(y.Main,{"aria-busy":Ye},s.createElement(D.HeaderLayout,{title:e({id:"global.roles",defaultMessage:"Roles"}),subtitle:e({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:s.createElement(p.CheckPermissions,{permissions:R.Z.createRole},s.createElement(A.Button,{onClick:As,startIcon:s.createElement(G(),null),size:"L"},e({id:(0,_.OB)("List.button.roles"),defaultMessage:"Add new role"})))}),s.createElement(D.ActionLayout,{startActions:s.createElement(p.SearchURLQuery,{label:e({id:"app.component.search.label",defaultMessage:"Search"})})}),s.createElement(D.ContentLayout,null,!I&&s.createElement(p.NoPermissions,null),(Ye||M)&&s.createElement(p.LoadingIndicatorPage,null),I&&W&&(W==null?void 0:W.length)?s.createElement(f.Table,{colCount:js,rowCount:xs},s.createElement(f.Thead,null,s.createElement(f.Tr,null,s.createElement(f.Th,null,s.createElement(P.Typography,{variant:"sigma",textColor:"neutral600"},e({id:"global.name",defaultMessage:"Name"}))),s.createElement(f.Th,null,s.createElement(P.Typography,{variant:"sigma",textColor:"neutral600"},e({id:"global.description",defaultMessage:"Description"}))),s.createElement(f.Th,null,s.createElement(P.Typography,{variant:"sigma",textColor:"neutral600"},e({id:"global.users",defaultMessage:"Users"}))),s.createElement(f.Th,null,s.createElement(U.VisuallyHidden,null,e({id:"global.actions",defaultMessage:"Actions"}))))),s.createElement(lt,{sortedRoles:W,canDelete:V,permissions:R.Z,setRoleToDelete:m,onDelete:[a,n]})):s.createElement(p.EmptyStateLayout,{content:Ss[Us]})),s.createElement(p.ConfirmDialog,{isConfirmButtonLoading:c,onConfirm:Is,onToggleDialog:Ls,isOpen:a})))},ut=()=>s.createElement(p.CheckPagePermissions,{permissions:R.Z.accessRoles},s.createElement(ct,null));var le=o(80831),S=o(9008),j=o(5493),ce=o(55967),ue=o(59626),dt=o(68717),pt=o.n(dt),mt=o(84734),de=o.n(mt),w=o(34626),$=o(84757),x=o(96486);const pe=(0,s.createContext)({}),me=({children:r,value:e})=>s.createElement(pe.Provider,{value:e},r),J=()=>(0,s.useContext)(pe);me.propTypes={children:C().node.isRequired,value:C().object.isRequired};var z=o(78384),gt=o(35161),ft=o.n(gt),Pt=o(13217),vt=o.n(Pt);const yt=r=>{switch(r){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Et=(0,z.default)(j.Box)`
  margin: -1px;
  border-radius: ${({theme:r})=>r.spaces[1]} 0 0 ${({theme:r})=>r.spaces[1]};
`;function q({route:r}){const{formatMessage:e}=(0,O.useIntl)(),{method:t,handler:i,path:u}=r,l=u?vt()(u.split("/")):[],[d="",a=""]=i?i.split("."):[],n=yt(r.method);return s.createElement(S.Stack,{spacing:2},s.createElement(P.Typography,{variant:"delta",as:"h3"},e({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",s.createElement("span",null,d),s.createElement(P.Typography,{variant:"delta",textColor:"primary600"},".",a)),s.createElement(S.Stack,{horizontal:!0,hasRadius:!0,background:"neutral0",borderColor:"neutral200",spacing:0},s.createElement(Et,{background:n.background,borderColor:n.border,padding:2},s.createElement(P.Typography,{fontWeight:"bold",textColor:n.text},t)),s.createElement(j.Box,{paddingLeft:2,paddingRight:2},ft()(l,c=>s.createElement(P.Typography,{key:c,textColor:c.includes(":")?"neutral600":"neutral900"},"/",c)))))}q.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},q.propTypes={route:C().shape({handler:C().string,method:C().string,path:C().string})};const ht=q,Ot=()=>{const{formatMessage:r}=(0,O.useIntl)(),{selectedAction:e,routes:t}=J(),i=(0,x.without)(e.split("."),"controllers"),u=(0,x.get)(t,i[0]),l=i.slice(1).join("."),d=(0,x.isEmpty)(u)?[]:u.filter(a=>a.handler.endsWith(l));return s.createElement(w.GridItem,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},e?s.createElement(S.Stack,{spacing:2},d.map((a,n)=>s.createElement(ht,{key:n,route:a}))):s.createElement(S.Stack,{spacing:2},s.createElement(P.Typography,{variant:"delta",as:"h3"},r({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})),s.createElement(P.Typography,{as:"p",textColor:"neutral600"},r({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var ee=o(96654),Rt=o(11700),Ct=o.n(Rt);function bt(r){switch(r){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return Ct()(r.replace("api::","").replace("plugin::",""))}}const Tt=bt;var Dt=o(89734),ge=o.n(Dt),fe=o(81325),At=o(70736),Lt=o.n(At);const Pe=z.css`
  background: ${r=>r.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,St=(0,z.default)(j.Box)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${r=>r.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${r=>r.isActive&&Pe}
  &:hover {
    ${Pe}
  }
`,wt=z.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:r})=>r.colors.neutral150};
`,ve=({subCategory:r})=>{const{formatMessage:e}=(0,O.useIntl)(),{onChange:t,onChangeSelectAll:i,onSelectedAction:u,selectedAction:l,modifiedData:d}=J(),a=(0,s.useMemo)(()=>(0,x.get)(d,r.name,{}),[d,r]),n=(0,s.useMemo)(()=>Object.values(a).every(m=>m.enabled===!0),[a]),c=(0,s.useMemo)(()=>Object.values(a).some(m=>m.enabled===!0)&&!n,[a,n]),g=(0,s.useCallback)(({target:{name:m}})=>{i({target:{name:m,value:!n}})},[n,i]),h=(0,s.useCallback)(m=>l===m,[l]);return s.createElement(j.Box,null,s.createElement(X.Flex,{justifyContent:"space-between",alignItems:"center"},s.createElement(j.Box,{paddingRight:4},s.createElement(P.Typography,{variant:"sigma",textColor:"neutral600"},r.label)),s.createElement(wt,null),s.createElement(j.Box,{paddingLeft:4},s.createElement(fe.Checkbox,{name:r.name,value:n,onValueChange:m=>g({target:{name:r.name,value:m}}),indeterminate:c},e({id:"app.utils.select-all",defaultMessage:"Select all"})))),s.createElement(X.Flex,{paddingTop:6,paddingBottom:6},s.createElement(w.Grid,{gap:2,style:{flex:1}},r.actions.map(m=>{const T=`${m.name}.enabled`;return s.createElement(w.GridItem,{col:6,key:m.name},s.createElement(St,{isActive:h(m.name),padding:2,hasRadius:!0},s.createElement(fe.Checkbox,{value:(0,x.get)(d,T,!1),name:T,onValueChange:b=>t({target:{name:T,value:b}})},m.label),s.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>u(m.name),style:{display:"inline-flex",alignItems:"center"}},s.createElement(Lt(),null))))}))))};ve.propTypes={subCategory:C().object.isRequired};const Mt=ve;var It=Object.defineProperty,Ut=Object.defineProperties,jt=Object.getOwnPropertyDescriptors,ye=Object.getOwnPropertySymbols,xt=Object.prototype.hasOwnProperty,Bt=Object.prototype.propertyIsEnumerable,Ee=(r,e,t)=>e in r?It(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Nt=(r,e)=>{for(var t in e||(e={}))xt.call(e,t)&&Ee(r,t,e[t]);if(ye)for(var t of ye(e))Bt.call(e,t)&&Ee(r,t,e[t]);return r},_t=(r,e)=>Ut(r,jt(e));const he=({name:r,permissions:e})=>{const t=(0,s.useMemo)(()=>ge()(Object.values(e.controllers).reduce((i,u,l)=>{const d=`${r}.controllers.${Object.keys(e.controllers)[l]}`,a=ge()(Object.keys(u).reduce((n,c)=>[...n,_t(Nt({},u[c]),{label:c,name:`${d}.${c}`})],[]),"label");return[...i,{actions:a,label:Object.keys(e.controllers)[l],name:d}]},[]),"label"),[r,e]);return s.createElement(j.Box,{padding:6},t.map(i=>s.createElement(Mt,{key:i.name,subCategory:i})))};he.propTypes={name:C().string.isRequired,permissions:C().object.isRequired};const Gt=he;var Ft=Object.defineProperty,Zt=Object.defineProperties,$t=Object.getOwnPropertyDescriptors,Oe=Object.getOwnPropertySymbols,kt=Object.prototype.hasOwnProperty,Vt=Object.prototype.propertyIsEnumerable,Re=(r,e,t)=>e in r?Ft(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ht=(r,e)=>{for(var t in e||(e={}))kt.call(e,t)&&Re(r,t,e[t]);if(Oe)for(var t of Oe(e))Vt.call(e,t)&&Re(r,t,e[t]);return r},Wt=(r,e)=>Zt(r,$t(e));const zt=(r,e)=>{const t=Object.keys(e).sort().map(i=>({name:i,isOpen:!1}));return Wt(Ht({},r),{collapses:t})};var K=o(8041),Kt=Object.defineProperty,Qt=Object.defineProperties,Xt=Object.getOwnPropertyDescriptors,Ce=Object.getOwnPropertySymbols,Yt=Object.prototype.hasOwnProperty,Jt=Object.prototype.propertyIsEnumerable,be=(r,e,t)=>e in r?Kt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Te=(r,e)=>{for(var t in e||(e={}))Yt.call(e,t)&&be(r,t,e[t]);if(Ce)for(var t of Ce(e))Jt.call(e,t)&&be(r,t,e[t]);return r},De=(r,e)=>Qt(r,Xt(e));const qt={collapses:[]},er=(r,e)=>(0,K.default)(r,t=>{switch(e.type){case"TOGGLE_COLLAPSE":{t.collapses=r.collapses.map((i,u)=>u===e.index?De(Te({},i),{isOpen:!i.isOpen}):De(Te({},i),{isOpen:!1}));break}default:return t}}),tr=()=>{const{modifiedData:r}=J(),{formatMessage:e}=(0,O.useIntl)(),[{collapses:t},i]=(0,s.useReducer)(er,qt,l=>zt(l,r)),u=l=>i({type:"TOGGLE_COLLAPSE",index:l});return s.createElement(S.Stack,{spacing:1},t.map((l,d)=>s.createElement(ee.Accordion,{expanded:l.isOpen,onToggle:()=>u(d),key:l.name,variant:d%2===0?"secondary":void 0},s.createElement(ee.AccordionToggle,{title:Tt(l.name),description:e({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:l.name}),variant:d%2?"primary":"secondary"}),s.createElement(ee.AccordionContent,null,s.createElement(j.Box,null,s.createElement(Gt,{permissions:r[l.name],name:l.name}))))))};var rr=Object.defineProperty,sr=Object.defineProperties,nr=Object.getOwnPropertyDescriptors,Ae=Object.getOwnPropertySymbols,or=Object.prototype.hasOwnProperty,ar=Object.prototype.propertyIsEnumerable,Le=(r,e,t)=>e in r?rr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ir=(r,e)=>{for(var t in e||(e={}))or.call(e,t)&&Le(r,t,e[t]);if(Ae)for(var t of Ae(e))ar.call(e,t)&&Le(r,t,e[t]);return r},lr=(r,e)=>sr(r,nr(e));const cr={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},ur=(r,e)=>(0,K.default)(r,t=>{switch(e.type){case"ON_CHANGE":{const i=e.keys.length,u=e.keys[i-1]==="enabled";if(e.value&&u){const l=(0,x.take)(e.keys,i-1).join(".");t.selectedAction=l}(0,x.set)(t,["modifiedData",...e.keys],e.value);break}case"ON_CHANGE_SELECT_ALL":{const i=["modifiedData",...e.keys],u=(0,x.get)(r,i,{}),l=Object.keys(u).reduce((d,a)=>(d[a]=lr(ir({},u[a]),{enabled:e.value}),d),{});(0,x.set)(t,i,l);break}case"ON_RESET":{t.modifiedData=r.initialData;break}case"ON_SUBMIT_SUCCEEDED":{t.initialData=r.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:i}=e;t.selectedAction=i===r.selectedAction?"":i;break}default:return t}});var dr=Object.defineProperty,pr=Object.defineProperties,mr=Object.getOwnPropertyDescriptors,Se=Object.getOwnPropertySymbols,gr=Object.prototype.hasOwnProperty,fr=Object.prototype.propertyIsEnumerable,we=(r,e,t)=>e in r?dr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Pr=(r,e)=>{for(var t in e||(e={}))gr.call(e,t)&&we(r,t,e[t]);if(Se)for(var t of Se(e))fr.call(e,t)&&we(r,t,e[t]);return r},vr=(r,e)=>pr(r,mr(e));const yr=(r,e,t)=>vr(Pr({},r),{initialData:e,modifiedData:e,routes:t});var Er=Object.defineProperty,hr=Object.defineProperties,Or=Object.getOwnPropertyDescriptors,Me=Object.getOwnPropertySymbols,Rr=Object.prototype.hasOwnProperty,Cr=Object.prototype.propertyIsEnumerable,Ie=(r,e,t)=>e in r?Er(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,br=(r,e)=>{for(var t in e||(e={}))Rr.call(e,t)&&Ie(r,t,e[t]);if(Me)for(var t of Me(e))Cr.call(e,t)&&Ie(r,t,e[t]);return r},Tr=(r,e)=>hr(r,Or(e));const Ue=(0,s.forwardRef)(({permissions:r,routes:e},t)=>{const{formatMessage:i}=(0,O.useIntl)(),[u,l]=(0,s.useReducer)(ur,cr,g=>yr(g,r,e));(0,s.useImperativeHandle)(t,()=>({getPermissions:()=>({permissions:u.modifiedData}),resetForm:()=>{l({type:"ON_RESET"})},setFormAfterSubmit:()=>{l({type:"ON_SUBMIT_SUCCEEDED"})}}));const d=({target:{name:g,value:h}})=>l({type:"ON_CHANGE",keys:g.split("."),value:h==="empty__string_value"?"":h}),a=({target:{name:g,value:h}})=>l({type:"ON_CHANGE_SELECT_ALL",keys:g.split("."),value:h}),n=g=>l({type:"SELECT_ACTION",actionToSelect:g}),c=Tr(br({},u),{onChange:d,onChangeSelectAll:a,onSelectedAction:n});return s.createElement(me,{value:c},s.createElement(w.Grid,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},s.createElement(w.GridItem,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},s.createElement(S.Stack,{spacing:6},s.createElement(S.Stack,{spacing:2},s.createElement(P.Typography,{variant:"delta",as:"h2"},i({id:(0,$.Z)("Plugins.header.title"),defaultMessage:"Permissions"})),s.createElement(P.Typography,{as:"p",textColor:"neutral600"},i({id:(0,$.Z)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."}))),s.createElement(tr,null))),s.createElement(Ot,null)))});Ue.propTypes={permissions:C().object.isRequired,routes:C().object.isRequired};const je=(0,s.memo)(Ue),Ws={isLoading:!0,modifiedData:{}},zs=(r,e)=>produce(r,t=>{switch(e.type){case"GET_DATA":{t.isLoading=!0,t.modifiedData={};break}case"GET_DATA_SUCCEEDED":{t.isLoading=!1,t.modifiedData=e.data;break}case"GET_DATA_ERROR":{t.isLoading=!0;break}case"ON_SUBMIT_SUCCEEDED":{t.modifiedData=e.data;break}default:return t}}),Ks=null;var Dr=o(25108),Ar=(r,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(r,e)).next())});const Qs=(r,e)=>{const{isLoading:t,allowedActions:i}=useRBAC(e),[{isLoading:u,modifiedData:l},d]=useReducer(reducer,initialState),a=useNotification(),n=useRef(!0),c=new AbortController,{signal:g}=c;useEffect(()=>(t||(()=>Ar(void 0,null,function*(){try{d({type:"GET_DATA"});const T=yield request(getRequestURL(r),{method:"GET",signal:g});d({type:"GET_DATA_SUCCEEDED",data:T})}catch(T){n.current&&(d({type:"GET_DATA_ERROR"}),Dr.error(T),a({type:"warning",message:{id:"notification.error"}}))}}))(),()=>{c.abort(),n.current=!1}),[t,r]);const h=useCallback(m=>{d({type:"ON_SUBMIT_SUCCEEDED",data:m})},[]);return{allowedActions:i,dispatchSubmitSucceeded:h,isLoading:u,isLoadingForPermissions:t,modifiedData:l}},Xs=null;var Lr=Object.defineProperty,Sr=Object.defineProperties,wr=Object.getOwnPropertyDescriptors,xe=Object.getOwnPropertySymbols,Mr=Object.prototype.hasOwnProperty,Ir=Object.prototype.propertyIsEnumerable,Be=(r,e,t)=>e in r?Lr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ur=(r,e)=>{for(var t in e||(e={}))Mr.call(e,t)&&Be(r,t,e[t]);if(xe)for(var t of xe(e))Ir.call(e,t)&&Be(r,t,e[t]);return r},jr=(r,e)=>Sr(r,wr(e));const Ys=(r,e)=>jr(Ur({},r),{isLoading:e}),Js=null,qs={roles:[],isLoading:!0},en=(r,e)=>produce(r,t=>{switch(e.type){case"GET_DATA":{t.isLoading=!0,t.roles=[];break}case"GET_DATA_SUCCEEDED":{t.roles=e.data,t.isLoading=!1;break}case"GET_DATA_ERROR":{t.isLoading=!1;break}default:return t}}),tn=null;var xr=(r,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(r,e)).next())});const rn=(r=!0)=>{const[{roles:e,isLoading:t},i]=useReducer(reducer,initialState,()=>init(initialState,r)),u=useNotification(),l=useRef(!0),d=new AbortController,{signal:a}=d;useEffect(()=>(r&&n(),()=>{d.abort(),l.current=!1}),[r]);const n=()=>xr(void 0,null,function*(){try{i({type:"GET_DATA"});const{roles:c}=yield request(`/${pluginId}/roles`,{method:"GET",signal:a});i({type:"GET_DATA_SUCCEEDED",data:c})}catch(c){const g=get(c,["response","payload","message"],"An error occured");l.current&&(i({type:"GET_DATA_ERROR"}),g!=="Forbidden"&&u({type:"warning",message:g}))}});return{roles:e,isLoading:t,getData:n}},sn=null;var Br=Object.defineProperty,Nr=Object.defineProperties,_r=Object.getOwnPropertyDescriptors,Ne=Object.getOwnPropertySymbols,Gr=Object.prototype.hasOwnProperty,Fr=Object.prototype.propertyIsEnumerable,_e=(r,e,t)=>e in r?Br(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Zr=(r,e)=>{for(var t in e||(e={}))Gr.call(e,t)&&_e(r,t,e[t]);if(Ne)for(var t of Ne(e))Fr.call(e,t)&&_e(r,t,e[t]);return r},$r=(r,e)=>Nr(r,_r(e));const kr=(r,e)=>$r(Zr({},r),{isLoading:e});var Q=o(46979);const Ge={permissions:{},routes:{},isLoading:!0},Vr=(r,e)=>(0,K.default)(r,t=>{switch(e.type){case"GET_DATA":{t.isLoading=!0,t.permissions={},t.routes={};break}case"GET_DATA_SUCCEEDED":{t.permissions=e.permissions,t.routes=e.routes,t.isLoading=!1;break}case"GET_DATA_ERROR":{t.isLoading=!1;break}default:return t}});var Fe=(r,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(r,e)).next())});const Ze=(r=!0)=>{const e=(0,p.useNotification)(),[{permissions:t,routes:i,isLoading:u},l]=(0,s.useReducer)(Vr,Ge,()=>kr(Ge,r)),d=(0,s.useCallback)(()=>Fe(void 0,null,function*(){try{l({type:"GET_DATA"});const[{permissions:a},{routes:n}]=yield Promise.all([`/${v.Z}/permissions`,`/${v.Z}/routes`].map(c=>Fe(void 0,null,function*(){return(yield Q.Z.get(c)).data})));l({type:"GET_DATA_SUCCEEDED",permissions:(0,_.YX)(a),routes:n})}catch(a){const n=(0,x.get)(a,["response","payload","message"],"An error occured");l({type:"GET_DATA_ERROR"}),n!=="Forbidden"&&e({type:"warning",message:n})}}),[e]);return(0,s.useEffect)(()=>{r&&d()},[d,r]),{permissions:t,routes:i,getData:d,isLoading:u}},Hr={role:{},isLoading:!0},Wr=(r,e)=>(0,K.default)(r,t=>{switch(e.type){case"GET_DATA_SUCCEEDED":{t.role=e.role,t.isLoading=!1;break}case"GET_DATA_ERROR":{t.isLoading=!1;break}case"ON_SUBMIT_SUCCEEDED":{t.role.name=e.name,t.role.description=e.description;break}default:return t}});var zr=o(25108),Kr=Object.defineProperty,Qr=Object.defineProperties,Xr=Object.getOwnPropertyDescriptors,$e=Object.getOwnPropertySymbols,Yr=Object.prototype.hasOwnProperty,Jr=Object.prototype.propertyIsEnumerable,ke=(r,e,t)=>e in r?Kr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ve=(r,e)=>{for(var t in e||(e={}))Yr.call(e,t)&&ke(r,t,e[t]);if($e)for(var t of $e(e))Jr.call(e,t)&&ke(r,t,e[t]);return r},qr=(r,e)=>Qr(r,Xr(e)),es=(r,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(r,e)).next())});const ts=r=>{const[e,t]=(0,s.useReducer)(Wr,Hr),i=(0,p.useNotification)(),u=(0,s.useRef)(null);(0,s.useEffect)(()=>(u.current=!0,r?l(r):t({type:"GET_DATA_SUCCEEDED",role:{}}),()=>u.current=!1),[r]);const l=a=>es(void 0,null,function*(){try{const{data:{role:n}}=yield Q.Z.get(`/${v.Z}/roles/${a}`);u.current&&t({type:"GET_DATA_SUCCEEDED",role:n})}catch(n){zr.error(n),t({type:"GET_DATA_ERROR"}),i({type:"warning",message:{id:"notification.error"}})}}),d=(0,s.useCallback)(a=>{t(Ve({type:"ON_SUBMIT_SUCCEEDED"},a))},[]);return qr(Ve({},e),{onSubmitSucceeded:d})};var k=o(53209);const rs=k.Ry().shape({name:k.Z_().required(p.translatedErrors.required),description:k.Z_().required(p.translatedErrors.required)});var ss=o(25108),ns=Object.defineProperty,os=Object.defineProperties,as=Object.getOwnPropertyDescriptors,He=Object.getOwnPropertySymbols,is=Object.prototype.hasOwnProperty,ls=Object.prototype.propertyIsEnumerable,We=(r,e,t)=>e in r?ns(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ze=(r,e)=>{for(var t in e||(e={}))is.call(e,t)&&We(r,t,e[t]);if(He)for(var t of He(e))ls.call(e,t)&&We(r,t,e[t]);return r},cs=(r,e)=>os(r,as(e)),us=(r,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(r,e)).next())});const ds=()=>{const{formatMessage:r}=(0,O.useIntl)(),[e,t]=(0,s.useState)(!1),i=(0,p.useNotification)(),{lockApp:u,unlockApp:l}=(0,p.useOverlayBlocker)(),{params:{id:d}}=(0,E.useRouteMatch)(`/settings/${v.Z}/roles/:id`),{isLoading:a,routes:n}=Ze(),{role:c,onSubmitSucceeded:g,isLoading:h}=ts(d),m=(0,s.useRef)(),T=b=>us(void 0,null,function*(){u(),t(!0);try{const M=m.current.getPermissions();yield Q.Z.put(`/${v.Z}/roles/${d}`,cs(ze(ze({},b),M),{users:[]})),g({name:b.name,description:b.description}),i({type:"success",message:{id:(0,$.Z)("Settings.roles.edited"),defaultMessage:"Role edited"}})}catch(M){ss.error(M),i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}t(!1),l()});return h?s.createElement(p.LoadingIndicatorPage,null):s.createElement(y.Main,null,s.createElement(p.SettingsPageTitle,{name:"Roles"}),s.createElement(le.Formik,{enableReinitialize:!0,initialValues:{name:c.name,description:c.description},onSubmit:T,validationSchema:rs},({handleSubmit:b,values:M,handleChange:I,errors:V})=>s.createElement(p.Form,{noValidate:!0,onSubmit:b},s.createElement(D.HeaderLayout,{primaryAction:!a&&s.createElement(A.Button,{disabled:c.code==="strapi-super-admin",type:"submit",loading:e,startIcon:s.createElement(de(),null)},r({id:"global.save",defaultMessage:"Save"})),title:c.name,subtitle:c.description,navigationAction:s.createElement(p.Link,{startIcon:s.createElement(pt(),null),to:"/settings/users-permissions/roles"},r({id:"global.back",defaultMessage:"Back"}))}),s.createElement(D.ContentLayout,null,s.createElement(S.Stack,{spacing:7},s.createElement(j.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},s.createElement(S.Stack,{spacing:4},s.createElement(P.Typography,{variant:"delta",as:"h2"},r({id:(0,$.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),s.createElement(w.Grid,{gap:4},s.createElement(w.GridItem,{col:6},s.createElement(ce.TextInput,{name:"name",value:M.name||"",onChange:I,label:r({id:"global.name",defaultMessage:"Name"}),error:V.name?r({id:V.name,defaultMessage:"Invalid value"}):null})),s.createElement(w.GridItem,{col:6},s.createElement(ue.Textarea,{name:"description",value:M.description||"",onChange:I,label:r({id:"global.description",defaultMessage:"Description"}),error:V.description?r({id:V.description,defaultMessage:"Invalid value"}):null}))))),!a&&s.createElement(je,{ref:m,permissions:c.permissions,routes:n}))))))},ps=()=>s.createElement(p.CheckPagePermissions,{permissions:R.Z.updateRole},s.createElement(ds,null)),ms=k.Ry().shape({name:k.Z_().required(p.translatedErrors.required),description:k.Z_().required(p.translatedErrors.required)});var gs=o(25108),fs=Object.defineProperty,Ps=Object.defineProperties,vs=Object.getOwnPropertyDescriptors,Ke=Object.getOwnPropertySymbols,ys=Object.prototype.hasOwnProperty,Es=Object.prototype.propertyIsEnumerable,Qe=(r,e,t)=>e in r?fs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Xe=(r,e)=>{for(var t in e||(e={}))ys.call(e,t)&&Qe(r,t,e[t]);if(Ke)for(var t of Ke(e))Es.call(e,t)&&Qe(r,t,e[t]);return r},hs=(r,e)=>Ps(r,vs(e)),Os=(r,e,t)=>new Promise((i,u)=>{var l=n=>{try{a(t.next(n))}catch(c){u(c)}},d=n=>{try{a(t.throw(n))}catch(c){u(c)}},a=n=>n.done?i(n.value):Promise.resolve(n.value).then(l,d);a((t=t.apply(r,e)).next())});const Rs=()=>{const{formatMessage:r}=(0,O.useIntl)(),[e,t]=(0,s.useState)(!1),i=(0,p.useNotification)(),{goBack:u}=(0,E.useHistory)(),{lockApp:l,unlockApp:d}=(0,p.useOverlayBlocker)(),{isLoading:a,permissions:n,routes:c}=Ze(),{trackUsage:g}=(0,p.useTracking)(),h=(0,s.useRef)(),m=T=>Os(void 0,null,function*(){l(),t(!0);try{const b=h.current.getPermissions();yield Q.Z.post(`/${v.Z}/roles`,hs(Xe(Xe({},T),b),{users:[]})),g("didCreateRole"),i({type:"success",message:{id:(0,$.Z)("Settings.roles.created"),defaultMessage:"Role created"}}),u()}catch(b){gs.error(b),i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}t(!1),d()});return s.createElement(y.Main,null,s.createElement(p.SettingsPageTitle,{name:"Roles"}),s.createElement(le.Formik,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:m,validationSchema:ms},({handleSubmit:T,values:b,handleChange:M,errors:I})=>s.createElement(p.Form,{noValidate:!0,onSubmit:T},s.createElement(D.HeaderLayout,{primaryAction:!a&&s.createElement(A.Button,{type:"submit",loading:e,startIcon:s.createElement(de(),null)},r({id:"global.save",defaultMessage:"Save"})),title:r({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:r({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),s.createElement(D.ContentLayout,null,s.createElement(S.Stack,{spacing:7},s.createElement(j.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},s.createElement(S.Stack,{spacing:4},s.createElement(P.Typography,{variant:"delta",as:"h2"},r({id:(0,$.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),s.createElement(w.Grid,{gap:4},s.createElement(w.GridItem,{col:6},s.createElement(ce.TextInput,{name:"name",value:b.name||"",onChange:M,label:r({id:"global.name",defaultMessage:"Name"}),error:I.name?r({id:I.name,defaultMessage:"Invalid value"}):null})),s.createElement(w.GridItem,{col:6},s.createElement(ue.Textarea,{name:"description",value:b.description||"",onChange:M,label:r({id:"global.description",defaultMessage:"Description"}),error:I.description?r({id:I.description,defaultMessage:"Invalid value"}):null}))))),!a&&s.createElement(je,{ref:h,permissions:n,routes:c}))))))},Cs=()=>s.createElement(p.CheckPagePermissions,{permissions:R.Z.createRole},s.createElement(Rs,null)),bs=()=>s.createElement(p.CheckPagePermissions,{permissions:R.Z.accessRoles},s.createElement(E.Switch,null,s.createElement(E.Route,{path:`/settings/${v.Z}/roles/new`,component:Cs,exact:!0}),s.createElement(E.Route,{path:`/settings/${v.Z}/roles/:id`,component:ps,exact:!0}),s.createElement(E.Route,{path:`/settings/${v.Z}/roles`,component:ut,exact:!0}),s.createElement(E.Route,{path:"",component:p.NotFound})))},46979:(F,B,o)=>{"use strict";o.d(B,{Z:()=>D});var s=o(9669),E=o.n(s),p=o(68547),v=o.n(p),R=(y,f,U)=>new Promise((P,N)=>{var Z=L=>{try{O(U.next(L))}catch(H){N(H)}},G=L=>{try{O(U.throw(L))}catch(H){N(H)}},O=L=>L.done?P(L.value):Promise.resolve(L.value).then(Z,G);O((U=U.apply(y,f)).next())});const A=E().create({baseURL:""});A.interceptors.request.use(y=>R(void 0,null,function*(){return y.headers={Authorization:`Bearer ${p.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},y}),y=>{Promise.reject(y)}),A.interceptors.response.use(y=>y,y=>{var f;throw((f=y.response)==null?void 0:f.status)===401&&(p.auth.clearAppStorage(),window.location.reload()),y});const D=A},89031:(F,B,o)=>{"use strict";o.d(B,{be:()=>s.Z,YX:()=>v,Gc:()=>D,OB:()=>y.Z});var s=o(46979),E=o(96486);const v=f=>Object.keys(f).reduce((U,P)=>{const N=f[P].controllers,Z=Object.keys(N).reduce((G,O)=>((0,E.isEmpty)(N[O])||(G[O]=N[O]),G),{});return(0,E.isEmpty)(Z)||(U[P]={controllers:Z}),U},{});var R=o(31498);const D=f=>`/${R.Z}/${f}`;var y=o(84757)},35161:(F,B,o)=>{var s=o(29932),E=o(67206),p=o(69199),v=o(1469);function R(A,D){var y=v(A)?s:p;return y(A,E(D,3))}F.exports=R},13217:(F,B,o)=>{var s=o(14259);function E(p){var v=p==null?0:p.length;return v?s(p,1,v):[]}F.exports=E}}]);
